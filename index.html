<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8;">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name = "viewport" content = "user-scalable=no, initial-scale=1.0, maximum-scale=1.0, width=device-width">
		<title>Paella Engage Example</title>
		<script type="text/javascript" src="javascript/traceur-runtime.min.js"></script>
		<script type="text/javascript" src="javascript/swfobject.js"></script>
		<script type="text/javascript" src="javascript/base.js"></script>
		<script type="text/javascript" src="javascript/jquery.js"></script>
		<script type="text/javascript" src="javascript/lunr.min.js"></script>
		<script type="text/javascript" src="javascript/require.js"></script>
		<script type="text/javascript" src="javascript/paella_player.js"></script>

		<link rel="stylesheet" href="resources/bootstrap/css/bootstrap.min.css" type="text/css" media="screen" charset="utf-8">

		<script>

			// Sample implementation of the authentication URL callback.
			// Put the callback name in config.json, auth.authCallbackName
			function authenticationUrl(redirect) {
				redirect = redirect ? "?redirect=" + encodeURIComponent(redirect): "";
				console.log(redirect);
				return "https://www.upv.es/auth" + redirect;
			}

			// Sample implementation of the user data callback
			// Put the callback name in config,json, auth.userDataCallbackName
			function videoData(onSuccess) {
				onSuccess({
					permissions: {
						canRead: true,
						canContribute: false,
						canWrite: false,
						loadError: false,
						isAnonymous: true
					},
					userData: {
						username: 'anonymous',
						name: 'Anonymous',
						avatar: 'resources/images/default_avatar.png'
					}
				});
			}



			// Sample configuration to use this callbacks:
			/*

			 "auth":{
			 	"authCallbackName":"authenticationUrl",
			 	"userDataCallbackName":"videoData"
			 }
			 */
		</script>
	</head>
<!--	<body id="body" onload="loadStandalonePaella('playerContainer');"> -->
    <body id="body">
		<div id="playerContainer" style="display:block;width:100%">
		</div>
		<script charset="utf-8">
			//var loci = location.search.replace('?id=', '');
			//console.log(loci);
			// RTEST
			function getParamValue(paramName)
			{
			    var url = window.location.search.substring(1); //get rid of "?" in querystring
			    var qArray = url.split('&'); //get key-value pairs
			    for (var i = 0; i < qArray.length; i++)
			    {
			        var pArr = qArray[i].split('='); //split key and value
			        if (pArr[0] == paramName)
			            return pArr[1]; //return value
			    }
			}
			var videoResourceId = getParamValue('id');
			console.log(videoResourceId);

			var videoResourceCaptions = getParamValue('captions');
			console.log(videoResourceCaptions);
			// RTEST
			var dataJSON = {
				"metadata": {
					"duration": 0,
					"title": ""
				},
				"streams": [
					{
						"sources": {
							"mp4": [
								{
									"src": "https://video.mhdev.man.ac.uk/weblounge-files/"+ videoResourceId,
									"mimetype": "video/mp4",
									"res": {
										"w": "1280",
										"h": "720"
									}
								}
							]
						},
						"preview": "https://video.mhdev.man.ac.uk/weblounge-previews/"+ videoResourceId
					}
				],
				"frameList": [
				],
				"captions": [
					{
						"lang": "en",
						"text": "English",
						"format": "vtt",
						"url": videoResourceCaptions
					}
				]
			};
			console.log(dataJSON.streams[0].sources.mp4[0].src);
			paella.load('playerContainer', { data:dataJSON });
		</script>
	</body>
</html>
